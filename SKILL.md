# nekro-plugin-social-memory

## Skill: 社交记忆系统 (Social Memory System)

整合用户好感度追踪和个性化记忆管理的社交记忆系统。

### 设计理念

借鉴 `history_travel` 的历史检索能力 + `note.py` 的持久化机制，设计一个专注于**社交关系**的记忆系统：

1. **关系维度**: 按用户追踪关系发展（好感度 + 事件历史）
2. **记忆维度**: 按用户聚合关键信息（偏好、约定、兴趣）
3. **智能注入**: 根据当前上下文自动注入相关记忆
4. **灵活配置**: 提供多个配置项控制行为

### 核心功能

1. **好感度系统**:
   - 6 级关系等级（敌人 → 陌生人 → 熟人 → 朋友 → 密友 → 灵魂伴侣）
   - 事件驱动的好感度变化（正面/负面/中性/危机）
   - 6 个羁绊解锁特殊能力

2. **用户记忆**:
   - 5 种记忆类型（偏好/信息/约定/兴趣/习惯）
   - 重要性评分（0-10）
   - 自动过期清理（默认 30 天）
   - 自动提取用户消息中的关键信息

3. **智能注入**:
   - 自动将关系状态注入 AI 上下文
   - 自动注入高重要性用户记忆
   - 可配置的注入数量和阈值

### 配置项

```yaml
plugins:
  social_memory:
    # 记忆配置
    RETENTION_DAYS: 30              # 记忆保留天数
    MAX_INJECTED_MEMORIES: 5        # 注入提示的最大记忆数
    MIN_IMPORTANCE_SCORE: 5         # 最小重要性分数（0-10）

    # 好感度配置
    DEFAULT_AFFECTION: 0            # 默认初始好感度
    MAX_HISTORY_EVENTS: 20          # 最大历史事件数
    ENABLE_BOND_SYSTEM: true        # 启用羁绊系统

    # 提示注入配置
    AFFECTION_PROMPT_LIMIT: 3       # 注入提示的事件数
```

### 沙盒方法

#### 好感度相关
| 方法 | 类型 | 描述 |
|------|------|------|
| `获取关系状态` | TOOL | 查询用户好感度和关系等级 |
| `记录关系事件` | BEHAVIOR | 记录好感度变化事件 |
| `获取互动历史` | TOOL | 查看关系发展历史 |
| `获取羁绊信息` | TOOL | 查看羁绊解锁进度 |

#### 用户记忆相关
| 方法 | 类型 | 描述 |
|------|------|------|
| `记录用户记忆` | BEHAVIOR | 记录用户特定信息 |
| `查询用户记忆` | TOOL | 按条件查询记忆 |
| `搜索用户记忆` | TOOL | 关键词搜索记忆 |
| `获取用户摘要` | TOOL | 获取用户摘要统计 |

#### 聚合功能
| 方法 | 类型 | 描述 |
|------|------|------|
| `获取用户档案` | AGENT | 整合生成用户档案 |

### 使用示例

```python
# 记录一次正面互动
record_affection_event(
    user_id="user_123",
    change_amount=5,
    event_type="positive",
    description="用户真诚感谢",
    context="帮助完成重要任务"
)

# 查询关系状态
status = get_affection_state(user_id="user_123")
# 返回: {tier: "friend", affection_value: 25, ...}

# 记录用户偏好
record_user_memory(
    user_id="user_123",
    memory_type="preference",
    content="用户喜欢用中文交流",
    importance=8
)

# 搜索用户记忆
memories = search_user_memory(
    user_id="user_123",
    keyword="中文"
)

# 获取完整用户档案
profile = get_user_profile(user_id="user_123")
```

### 设计灵感来源

- **history_travel**: 关键词检索 + 范围查询机制
- **note.py**: 持久化存储 + 提示注入模式
- **emotion.py**: 事件类型分类 + 重要性评分

### 与单独插件的对比

| 特性 | 分离方案 | 整合方案 |
|------|---------|---------|
| 插件数量 | 2 | 1 |
| 数据结构 | 分离 | 统一 SocialData |
| 提示注入 | 2 次 | 1 次整合 |
| 用户体验 | 需要记忆多个插件 | 一站式社交记忆 |

### 开发状态

- [x] 好感度系统（6 级关系 + 事件记录）
- [x] 用户记忆（5 种类型 + 自动提取）
- [x] 智能提示注入
- [x] 羁绊系统
- [ ] 测试用例
- [ ] 记忆重要性自动学习
- [ ] 关系发展可视化

### 未来增强方向

1. **记忆重要性自动学习**: 根据记忆被引用的频率自动调整重要性
2. **关系发展可视化**: 图表展示关系随时间的演变
3. **跨会话记忆继承**: 在不同频道间共享社交数据
4. **智能建议**: 基于关系状态建议 AI 的对话策略

---

**作者**: Yuki  
**GitHub**: @YukiAcerium  
**许可证**: MIT
